name: tpm2-tss
dependencies:
  - stage: base
  - stage: pkg-config
    runtime: true
  - stage: curl
  - stage: openssl
  - stage: libjson-c
  - stage: util-linux
steps:
  - sources:
      - url: https://github.com/tpm2-software/tpm2-tss/releases/download/{{ .tpm2_tss_version }}/tpm2-tss-{{ .tpm2_tss_version }}.tar.gz
        destination: tpm2-tss.tar.gz
        sha256: "{{ .tpm2_tss_sha256 }}"
        sha512: "{{ .tpm2_tss_sha512 }}"
    prepare:
      - |
        tar -xf tpm2-tss.tar.gz --strip-components=1

        ./configure \
          --prefix=${TOOLCHAIN} \
          --disable-weakcrypto \
          --disable-doxygen-doc \
          --disable-doxygen-man \
          --disable-doxygen-rtf \
          --disable-doxygen-xml \
          --disable-doxygen-chm \
          --disable-doxygen-chi \
          --disable-doxygen-html \
          --disable-doxygen-ps \
          --disable-doxygen-pdf
    build:
      - |
        make -j $(nproc)
    install:
      - |
        make DESTDIR=/rootfs install
        rm -rf /rootfs/toolchain/{etc,share}
finalize:
  - from: /rootfs
    to: /
